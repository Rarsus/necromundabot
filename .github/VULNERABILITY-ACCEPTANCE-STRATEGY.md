# Vulnerability Acceptance Strategy

**Version:** 1.0
**Date:** January 28, 2026
**Status:** ACTIVE
**Phase:** 03.3 - Fix GitHub Actions Workflows

---

## Executive Summary

NecromundaBot accepts 7 known vulnerabilities (3 HIGH, 4 MODERATE) from the discord.js v14.x dependency chain with a clear remediation path. This strategy allows CI/CD pipelines to proceed while maintaining security posture by blocking NEW vulnerabilities not in the baseline.

**Key Principle:** Accepted vulnerabilities don't block progress, but NEW vulnerabilities do.

---

## Vulnerability Acceptance Criteria

### ‚úÖ Criteria for Acceptance

1. **Transitive Dependencies Only**
   - Vulnerability must be in indirect dependency chains
   - Direct dependencies must be vulnerability-free above LOW severity
   - Reasoning: Easier to fix when dependency updates

2. **Identified Fix Path**
   - Must have a known fix or workaround
   - Fix must be achievable within reasonable effort
   - Target remediation date must be documented

3. **Risk Assessment Complete**
   - Vulnerability impact must be assessed for our specific use case
   - Likelihood of exploitation must be evaluated
   - Mitigation measures (if any) documented

4. **Business Justification**
   - Blocking on vulnerability must be more costly than risk
   - Temporary acceptance must not become permanent

5. **Time-Boxed**
   - All accepted vulnerabilities have expiration dates
   - Baseline expires quarterly for re-evaluation
   - Hard deadline for remediation (not indefinite)

---

## Current Accepted Vulnerabilities

### Baseline: 7 Vulnerabilities (as of 2026-01-28)

#### Group 1: glob - Command Injection (HIGH) üî¥

**Affected:** necrobot-dashboard only
**Source:** @next/eslint-plugin-next v14-15 ‚Üí glob v9
**Effort:** 1-2 hours
**Target Date:** 2026-02-15

**Risk Assessment:**

- ‚úÖ **Likelihood: LOW** - Requires attacker to control glob options
- ‚úÖ **Impact: MEDIUM** - Would allow arbitrary command execution
- ‚úÖ **Mitigation: STRONG** - Dashboard is internal development tooling, not production
- ‚úÖ **Exposure: MINIMAL** - Only developers with code access affected

**Acceptance Justification:**
Dashboard is internal tooling, not production bot. Command injection requires developer control of glob parameters. Risk is acceptable while Next.js ecosystem stabilizes.

**Remediation Path:**

```bash
npm update @next/eslint-plugin-next@16.1.4+ in necrobot-dashboard
# Takes 1-2 hours, minimal breaking changes
```

---

#### Group 2: Undici - Unbounded Decompression (MODERATE √ó 4) üü°

**Affected:** necromundabot root, necrobot-core
**Source:** discord.js v14.x dependency chain
**Effort:** 22-35 hours (full migration) OR 1-2 hours (emergency mitigation)
**Target Date:** 2026-02-28 (discord.js v15 migration)

**Risk Assessment:**

- ‚úÖ **Likelihood: VERY LOW** - Requires specially crafted HTTP response
- ‚úÖ **Impact: MEDIUM** - Would cause memory exhaustion / DoS
- ‚úÖ **Mitigation: STRONG** - Bot only receives responses from Discord API (trusted)
- ‚úÖ **Exposure: MINIMAL** - No untrusted HTTP sources

**Acceptance Justification:**
Bot operates as Discord API client. Only receives responses from Discord's hardened infrastructure. Attacker would need to compromise Discord's servers (out of scope for our threat model). Accepting while discord.js v15 migration proceeds as planned phase.

**Remediation Path (Option A - Recommended):**

```bash
# Phase 03.1 implementation: discord.js v15 migration
# This is planned and documented
# Estimated: 22-35 hours total effort
# Includes discord.js ecosystem updates
```

**Remediation Path (Option B - Emergency):**

```bash
# Update only undici if discord.js v15 migration delayed
npm update undici@latest in all affected repos
# Takes 1-2 hours, minimal code changes
```

---

## Vulnerability Management Workflow

### Workflow Rules

**Rule 1: Accept Transitive Dependencies Only**

- Direct deps: Must be zero vulnerabilities above LOW
- Transitive: Can be accepted with justification

**Rule 2: New Vulnerabilities Block CI**

- ‚úÖ Vulnerabilities in baseline: PASS
- ‚ùå NEW vulnerabilities: FAIL
- ‚ùå INCREASED severity: FAIL
- ‚ùå UNKNOWN vulnerabilities: FAIL

**Rule 3: Baseline Review Quarterly**

- 2026-01-28: Initial baseline (7 vulns)
- 2026-04-28: Quarterly review (must be ‚â§ 7 vulns or justify increase)
- 2026-07-28: Next review
- Annually thereafter

**Rule 4: Approval Process**

```
New Acceptance Request
    ‚Üì
Security Review (CODEOWNERS)
    ‚Üì
Risk Assessment (documented)
    ‚Üì
Remediation Plan (required)
    ‚Üì
Add to Baseline (commit audit-baseline.json)
    ‚Üì
Update Workflows
```

**Rule 5: Escalation for Violations**

- New CRITICAL: Immediate escalation, potential incident response
- New HIGH not in baseline: Block PR, security review
- New MODERATE not in baseline: Block PR, require justification
- Baseline EXCEEDED: Fail all CI, immediate remediation required

---

## Pipeline Behavior with Baseline

### Security Workflow (`.github/workflows/security.yml`)

**Current:** ‚ùå Blocks PRs on ANY moderate+ vulnerability
**New:** ‚úÖ Blocks PRs ONLY on NEW vulnerabilities

```yaml
Audit Security Scan:
  1. Run: npm audit --json
  2. Load: .github/audit-baseline.json
  3. Compare: Current vs Baseline
  4. If vulnerabilities <= baseline
     ‚úÖ PASS (continue-on-error)
  5. If NEW vulnerabilities detected
     ‚ùå FAIL (block PR)
  6. Comment: Audit summary on PR
```

**Result:** PRs with known vulnerabilities can merge ‚úÖ

---

### PR Checks Workflow (`.github/workflows/pr-checks.yml`)

**Current:** ‚ùå Can't merge if audit fails
**New:** ‚úÖ Can merge if vulnerabilities <= baseline

```yaml
Dependency Check:
  1. Run: npm audit --json
  2. Compare: Against baseline
  3. If count <= baseline
     ‚úÖ PASS (allow merge)
  4. If count > baseline
     ‚ùå FAIL (block merge)
  5. Comment: Audit details on PR
```

**Result:** PRs unblocked unless introducing new vulnerabilities ‚úÖ

---

### Release Workflow (`.github/workflows/release.yml`)

**Current:** ‚ùå Can't release due to npm audit
**New:** ‚úÖ Can release if vulnerabilities <= baseline

```yaml
Pre-Release Audit:
  1. Run: npm audit --json
  2. Compare: Against baseline
  3. If count <= baseline
     ‚úÖ PROCEED (allow release)
  4. If count > baseline
     ‚ùå BLOCK (no release)
  5. Add: Audit summary to release notes
```

**Result:** Releases can proceed with documented accepted vulnerabilities ‚úÖ

---

## Communication & Transparency

### PR Audit Comment Template

```
## üîê Security Audit Summary

**Status:** ‚úÖ Acceptable (vulnerabilities ‚â§ baseline)

**Details:**
- Current vulnerabilities: 7 (3 HIGH, 4 MODERATE)
- Baseline vulnerabilities: 7 (3 HIGH, 4 MODERATE)
- Change: No new vulnerabilities detected ‚úÖ

**Accepted Vulnerabilities:**
- [ ] glob@9 (HIGH) - Dashboard only, Fix: @next/eslint-plugin-next@16+
- [x] undici@5-6 (MODERATE √ó 4) - Discord API client, Fix: discord.js@15 migration

**Timeline:**
- glob fix target: 2026-02-15
- undici fix target: 2026-02-28 (via discord.js v15)

**More Info:** See `.github/audit-baseline.json` and `VULNERABILITY-ACCEPTANCE-STRATEGY.md`
```

---

## Remediation Timeline

### Q1 2026 Targets

| Target                                  | Date           | Effort | Status     |
| --------------------------------------- | -------------- | ------ | ---------- |
| Resolve glob (glob fix)                 | 2026-02-15     | 1-2h   | Planned    |
| Resolve undici (discord.js v15)         | 2026-02-28     | 22-35h | Planned    |
| **GOAL: Zero accepted vulnerabilities** | **2026-02-28** |        | Achievable |

### Phase 03.1 Implementation Schedule

**Phase 03.1.1:** ‚úÖ Analysis Complete (Jan 27)
**Phase 03.1.2-04:** Implementation (Feb 1-28)
**Release v1.0.0:** Feb 28 with 0 vulnerabilities

---

## Monitoring & Alerting

### Workflow Checks

‚úÖ **Passing Status:**

- Vulnerabilities: 7 (known)
- New vulnerabilities: 0 ‚úÖ
- Severity increase: 0 ‚úÖ
- Baseline exceeded: No ‚úÖ

### Alerts Triggered When:

| Condition                  | Alert Level | Action                     |
| -------------------------- | ----------- | -------------------------- |
| NEW vulnerabilities found  | üî¥ CRITICAL | Block PR, notify team      |
| Baseline EXCEEDED          | üî¥ CRITICAL | Block CI, immediate review |
| NEW CRITICAL vuln          | üî¥ CRITICAL | Escalate to security       |
| Baseline expires (90 days) | üü° WARNING  | Quarterly review           |

### Team Notifications

```yaml
New Vulnerability Detected:
  - Post on #security Slack channel
  - Tag @security-team and @engineering
  - Create GitHub issue for tracking
  - Require security sign-off before PR merge
```

---

## Review & Update Process

### Quarterly Baseline Review

**Schedule:** Every 90 days (2026-01-28, 2026-04-28, etc.)

**Review Checklist:**

- [ ] Still have 0 new vulnerabilities since last review?
- [ ] Any accepted vulns remediated? (Remove from baseline)
- [ ] Any baseline target dates passed? (Escalate if not fixed)
- [ ] Are remediation efforts on schedule?
- [ ] Any new vulnerabilities to accept?

**Update Process:**

1. Proposed changes to `.github/audit-baseline.json`
2. Security review and approval
3. Commit and PR merge
4. Update workflows if needed

---

## Exceptions & Escalation

### When Baseline Needs Updating

**Low-risk exceptions (don't break progress):**

- Adding known LOW severity vulns (auto-acceptable)
- Extending deadline by ‚â§30 days if fix in progress
- Adding transitive deps to exemptions if justified

**High-risk exceptions (require escalation):**

- Adding new CRITICAL vulnerabilities (security review)
- Adding HIGH vulns outside planned fixes
- Baseline exceeding 10 vulnerabilities
- Missing remediation deadline by > 30 days

---

## Success Metrics

### Phase 03.3 Goals

‚úÖ **Achieved When:**

1. Audit baseline created and committed
2. Workflows updated to check baseline
3. PRs no longer blocked by known vulnerabilities
4. Releases can proceed despite accepted vulnerabilities
5. New vulnerabilities still caught and blocked
6. Team understands vulnerability acceptance policy
7. Zero blocking issues due to npm audit

### Ongoing Success Criteria

‚úÖ **Maintained When:**

1. Vulnerabilities <= baseline (no unauthorized increase)
2. All accepted vulns have target dates
3. Baseline reviewed quarterly
4. Zero new vulnerabilities in baseline
5. New vulns caught before reaching main branch

---

## Document History

| Version | Date       | Changes                                      | Approver         |
| ------- | ---------- | -------------------------------------------- | ---------------- |
| 1.0     | 2026-01-28 | Initial strategy, 7 vulnerabilities accepted | Engineering Team |

---

## See Also

- **GitHub Issue:** #9 (Phase 03.3 Epic - Fix GitHub Actions Workflows)
- **Baseline File:** `.github/audit-baseline.json`
- **Phase 03.1:** npm Vulnerability Remediation & discord.js v15 Migration
- **Workflow Files:**
  - `.github/workflows/security.yml`
  - `.github/workflows/pr-checks.yml`
  - `.github/workflows/release.yml`

---

**Status:** ACTIVE - Approved January 28, 2026
